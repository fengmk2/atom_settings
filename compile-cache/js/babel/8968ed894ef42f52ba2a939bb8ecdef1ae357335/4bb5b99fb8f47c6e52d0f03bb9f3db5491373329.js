var DocsParser = require('../docsparser');
var xregexp = require('../xregexp').XRegExp;
var util = require('util');

function TypescriptParser(settings) {
    DocsParser.call(this, settings);
}

TypescriptParser.prototype = Object.create(DocsParser.prototype);

TypescriptParser.prototype.setup_settings = function () {
    var identifier = '[a-zA-Z_$][a-zA-Z_$0-9]*';
    var base_type_identifier = util.format('%s(\\.%s)*(\\[\\])?', identifier, identifier);
    var parametric_type_identifier = util.format('%s(\\s*<\\s*%s(\\s*,\\s*%s\\s*)*>)?', base_type_identifier, base_type_identifier, base_type_identifier);
    this.settings = {
        // curly brackets around the type information
        'curlyTypes': true,
        'typeInfo': true,
        'typeTag': 'type',
        // technically, they can contain all sorts of unicode, but w/e
        'varIdentifier': identifier,
        'fnIdentifier': identifier,
        'fnOpener': 'function(?:\\s+' + identifier + ')?\\s*\\(',
        'commentCloser': ' */',
        'bool': 'Boolean',
        'function': 'Function',
        'functionRE':
        // Modifiers
        '(?:public|private|static)?\\s*' +
        // Method name
        '(?P<name>' + identifier + ')\\s*' +
        // Params
        '\\((?P<args>.*)\\)\\s*' +
        // Return value
        '(:\\s*(?P<retval>' + parametric_type_identifier + '))?',
        'var_re': '((public|private|static|var)\\s+)?(?P<name>' + identifier + ')\\s*(:\\s*(?P<type>' + parametric_type_identifier + '))?(\\s*=\\s*(?P<val>.*?))?([;,]|$)'
    };
};

TypescriptParser.prototype.parse_function = function (line) {
    line = line.trim();
    var regex = xregexp(this.settings.functionRE);
    var matches = xregexp.exec(line, regex);
    if (matches === null) return null;

    return [matches.name, matches.args, matches.retval];
};

TypescriptParser.prototype.get_arg_type = function (arg) {
    if (arg.indexOf(':') > -1) {
        var arg_list = arg.split(':');
        return arg_list[arg_list.length - 1].trim();
    }
    return null;
};

TypescriptParser.prototype.get_arg_name = function (arg) {
    if (arg.indexOf(':') > -1) arg = arg.split(':')[0];

    var regex = /[ \?]/g;
    return arg.replace(regex, '');
};

TypescriptParser.prototype.parse_var = function (line) {
    var regex = xregexp(this.settings.var_re);
    var matches = xregexp.exec(line, regex);
    if (matches == null) return null;
    var val = matches.val;
    if (val != null) val = val.trim();

    return [matches.name, val, matches.type];
};

TypescriptParser.prototype.get_function_return_type = function (name, retval) {
    return retval != 'void' ? retval : null;
};

TypescriptParser.prototype.guess_type_from_value = function (val) {
    var lowerPrimitives = this.editor_settings.lower_case_primitives || false;
    if (this.is_numeric(val)) return lowerPrimitives ? 'number' : 'Number';
    if (val[0] == '\'' || val[0] == '"') return lowerPrimitives ? 'string' : 'String';
    if (val[0] == '[') return 'Array';
    if (val[0] == '{') return 'Object';
    if (val == 'true' || val == 'false') return lowerPrimitives ? 'boolean' : 'Boolean';
    var regex = new RegExp('RegExp\\b|\\/[^\\/]');
    if (regex.test(val)) {
        return 'RegExp';
    }
    if (val.slice(0, 4) == 'new ') {
        regex = new RegExp('new (' + this.settings.fnIdentifier + ')');
        var matches = regex.exec(val);
        return matches[0] && matches[1] || null;
    }
    return null;
};

module.exports = TypescriptParser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9tazIvLmF0b20vcGFja2FnZXMvZG9jYmxvY2tyL2xpYi9sYW5ndWFnZXMvdHlwZXNjcmlwdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDMUMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQztBQUM1QyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRTNCLFNBQVMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFO0FBQ2hDLGNBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0NBQ25DOztBQUVELGdCQUFnQixDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQzs7QUFFakUsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLGNBQWMsR0FBRyxZQUFXO0FBQ25ELFFBQUksVUFBVSxHQUFHLDBCQUEwQixDQUFDO0FBQzVDLFFBQUksb0JBQW9CLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7QUFDdEYsUUFBSSwwQkFBMEIsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLHFDQUFxQyxFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixFQUFFLG9CQUFvQixDQUFDLENBQUM7QUFDdEosUUFBSSxDQUFDLFFBQVEsR0FBRzs7QUFFWixvQkFBWSxFQUFFLElBQUk7QUFDbEIsa0JBQVUsRUFBRSxJQUFJO0FBQ2hCLGlCQUFTLEVBQUUsTUFBTTs7QUFFakIsdUJBQWUsRUFBRSxVQUFVO0FBQzNCLHNCQUFjLEVBQUUsVUFBVTtBQUMxQixrQkFBVSxFQUFFLGlCQUFpQixHQUFHLFVBQVUsR0FBRyxXQUFXO0FBQ3hELHVCQUFlLEVBQUUsS0FBSztBQUN0QixjQUFNLEVBQUUsU0FB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LE9BQU8sR0FBRyxnQkFBZ0IsQ0FBQyIsImZpbGUiOiIvVXNlcnMvbWsyLy5hdG9tL3BhY2thZ2VzL2RvY2Jsb2Nrci9saWIvbGFuZ3VhZ2VzL3R5cGVzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRG9jc1BhcnNlciA9IHJlcXVpcmUoXCIuLi9kb2NzcGFyc2VyXCIpO1xudmFyIHhyZWdleHAgPSByZXF1aXJlKCcuLi94cmVnZXhwJykuWFJlZ0V4cDtcbnZhciB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuXG5mdW5jdGlvbiBUeXBlc2NyaXB0UGFyc2VyKHNldHRpbmdzKSB7XG4gICAgRG9jc1BhcnNlci5jYWxsKHRoaXMsIHNldHRpbmdzKTtcbn1cblxuVHlwZXNjcmlwdFBhcnNlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKERvY3NQYXJzZXIucHJvdG90eXBlKTtcblxuVHlwZXNjcmlwdFBhcnNlci5wcm90b3R5cGUuc2V0dXBfc2V0dGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaWRlbnRpZmllciA9ICdbYS16QS1aXyRdW2EtekEtWl8kMC05XSonO1xuICAgIHZhciBiYXNlX3R5cGVfaWRlbnRpZmllciA9IHV0aWwuZm9ybWF0KCclcyhcXFxcLiVzKSooXFxcXFtcXFxcXSk/JywgaWRlbnRpZmllciwgaWRlbnRpZmllcik7XG4gICAgdmFyIHBhcmFtZXRyaWNfdHlwZV9pZGVudGlmaWVyID0gdXRpbC5mb3JtYXQoJyVzKFxcXFxzKjxcXFxccyolcyhcXFxccyosXFxcXHMqJXNcXFxccyopKj4pPycsIGJhc2VfdHlwZV9pZGVudGlmaWVyLCBiYXNlX3R5cGVfaWRlbnRpZmllciwgYmFzZV90eXBlX2lkZW50aWZpZXIpO1xuICAgIHRoaXMuc2V0dGluZ3MgPSB7XG4gICAgICAgIC8vIGN1cmx5IGJyYWNrZXRzIGFyb3VuZCB0aGUgdHlwZSBpbmZvcm1hdGlvblxuICAgICAgICAnY3VybHlUeXBlcyc6IHRydWUsXG4gICAgICAgICd0eXBlSW5mbyc6IHRydWUsXG4gICAgICAgICd0eXBlVGFnJzogJ3R5cGUnLFxuICAgICAgICAvLyB0ZWNobmljYWxseSwgdGhleSBjYW4gY29udGFpbiBhbGwgc29ydHMgb2YgdW5pY29kZSwgYnV0IHcvZVxuICAgICAgICAndmFySWRlbnRpZmllcic6IGlkZW50aWZpZXIsXG4gICAgICAgICdmbklkZW50aWZpZXInOiBpZGVudGlmaWVyLFxuICAgICAgICAnZm5PcGVuZXInOiAnZnVuY3Rpb24oPzpcXFxccysnICsgaWRlbnRpZmllciArICcpP1xcXFxzKlxcXFwoJyxcbiAgICAgICAgJ2NvbW1lbnRDbG9zZXInOiAnICovJyxcbiAgICAgICAgJ2Jvb2wnOiAnQm9vbGVhbicsXG4gICAgICAgICdmdW5jdGlvbic6ICdGdW5jdGlvbicsXG4gICAgICAgICdmdW5jdGlvblJFJzpcbiAgICAgICAgICAgIC8vIE1vZGlmaWVyc1xuICAgICAgICAgICAgJyg/OnB1YmxpY3xwcml2YXRlfHN0YXRpYyk/XFxcXHMqJyArXG4gICAgICAgICAgICAvLyBNZXRob2QgbmFtZVxuICAgICAgICAgICAgJyg/UDxuYW1lPicgKyBpZGVudGlmaWVyICsgJylcXFxccyonICtcbiAgICAgICAgICAgIC8vIFBhcmFtc1xuICAgICAgICAgICAgJ1xcXFwoKD9QPGFyZ3M+LiopXFxcXClcXFxccyonICtcbiAgICAgICAgICAgIC8vIFJldHVybiB2YWx1ZVxuICAgICAgICAgICAgJyg6XFxcXHMqKD9QPHJldHZhbD4nICsgcGFyYW1ldHJpY190eXBlX2lkZW50aWZpZXIgKyAnKSk/JyxcbiAgICAgICAgJ3Zhcl9yZSc6XG4gICAgICAgICAgICAnKChwdWJsaWN8cHJpdmF0ZXxzdGF0aWN8dmFyKVxcXFxzKyk/KD9QPG5hbWU+JyArIGlkZW50aWZpZXIgK1xuICAgICAgICAgICAgJylcXFxccyooOlxcXFxzKig/UDx0eXBlPicgKyBwYXJhbWV0cmljX3R5cGVfaWRlbnRpZmllciArXG4gICAgICAgICAgICAnKSk/KFxcXFxzKj1cXFxccyooP1A8dmFsPi4qPykpPyhbOyxdfCQpJ1xuICAgIH07XG59O1xuXG5UeXBlc2NyaXB0UGFyc2VyLnByb3RvdHlwZS5wYXJzZV9mdW5jdGlvbiA9IGZ1bmN0aW9uKGxpbmUpIHtcbiAgICBsaW5lID0gbGluZS50cmltKCk7XG4gICAgdmFyIHJlZ2V4ID0geHJlZ2V4cCh0aGlzLnNldHRpbmdzLmZ1bmN0aW9uUkUpO1xuICAgIHZhciBtYXRjaGVzID0geHJlZ2V4cC5leGVjKGxpbmUsIHJlZ2V4KTtcbiAgICBpZihtYXRjaGVzID09PSBudWxsKVxuICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiBbbWF0Y2hlcy5uYW1lLCBtYXRjaGVzLmFyZ3MsIG1hdGNoZXMucmV0dmFsXTtcbn07XG5cblR5cGVzY3JpcHRQYXJzZXIucHJvdG90eXBlLmdldF9hcmdfdHlwZSA9IGZ1bmN0aW9uKGFyZykge1xuICAgIGlmKGFyZy5pbmRleE9mKCc6JykgPiAtMSkge1xuICAgICAgICB2YXIgYXJnX2xpc3QgPSBhcmcuc3BsaXQoJzonKTtcbiAgICAgICAgcmV0dXJuIGFyZ19saXN0W2FyZ19saXN0Lmxlbmd0aCAtIDFdLnRyaW0oKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59O1xuXG5UeXBlc2NyaXB0UGFyc2VyLnByb3RvdHlwZS5nZXRfYXJnX25hbWUgPSBmdW5jdGlvbihhcmcpIHtcbiAgICBpZihhcmcuaW5kZXhPZignOicpID4gLTEpXG4gICAgICAgIGFyZyA9IGFyZy5zcGxpdCgnOicpWzBdO1xuXG4gICAgdmFyIHJlZ2V4ID0gL1sgXFw/XS9nO1xuICAgIHJldHVybiBhcmcucmVwbGFjZShyZWdleCwgJycpO1xufTtcblxuVHlwZXNjcmlwdFBhcnNlci5wcm90b3R5cGUucGFyc2VfdmFyID0gZnVuY3Rpb24obGluZSkge1xuICAgIHZhciByZWdleCA9IHhyZWdleHAodGhpcy5zZXR0aW5ncy52YXJfcmUpO1xuICAgIHZhciBtYXRjaGVzID0geHJlZ2V4cC5leGVjKGxpbmUsIHJlZ2V4KTtcbiAgICBpZihtYXRjaGVzID09IG51bGwpXG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIHZhciB2YWwgPSBtYXRjaGVzLnZhbDtcbiAgICBpZih2YWwgIT0gbnVsbClcbiAgICAgICAgdmFsID0gdmFsLnRyaW0oKTtcblxuICAgIHJldHVybiBbbWF0Y2hlcy5uYW1lLCB2YWwsIG1hdGNoZXMudHlwZV07XG59O1xuXG5UeXBlc2NyaXB0UGFyc2VyLnByb3RvdHlwZS5nZXRfZnVuY3Rpb25fcmV0dXJuX3R5cGUgPSBmdW5jdGlvbihuYW1lLCByZXR2YWwpIHtcbiAgICByZXR1cm4gKChyZXR2YWwgIT0gJ3ZvaWQnKSA/IHJldHZhbCA6IG51bGwpO1xufTtcblxuVHlwZXNjcmlwdFBhcnNlci5wcm90b3R5cGUuZ3Vlc3NfdHlwZV9mcm9tX3ZhbHVlID0gZnVuY3Rpb24odmFsKSB7XG4gICAgdmFyIGxvd2VyUHJpbWl0aXZlcyA9IHRoaXMuZWRpdG9yX3NldHRpbmdzLmxvd2VyX2Nhc2VfcHJpbWl0aXZlcyB8fCBmYWxzZTtcbiAgICBpZih0aGlzLmlzX251bWVyaWModmFsKSlcbiAgICAgICAgcmV0dXJuIChsb3dlclByaW1pdGl2ZXMgPyAnbnVtYmVyJyA6ICdOdW1iZXInKTtcbiAgICBpZigodmFsWzBdID09ICdcXCcnKSB8fCAodmFsWzBdID09ICdcIicpKVxuICAgICAgICByZXR1cm4gKGxvd2VyUHJpbWl0aXZlcyA/ICdzdHJpbmcnIDogJ1N0cmluZycpO1xuICAgIGlmKHZhbFswXSA9PSAnWycpXG4gICAgICAgIHJldHVybiAnQXJyYXknO1xuICAgIGlmKHZhbFswXSA9PSAneycpXG4gICAgICAgIHJldHVybiAnT2JqZWN0JztcbiAgICBpZigodmFsID09ICd0cnVlJykgfHwgKHZhbCA9PSAnZmFsc2UnKSlcbiAgICAgICAgcmV0dXJuIChsb3dlclByaW1pdGl2ZXMgPyAnYm9vbGVhbicgOiAnQm9vbGVhbicpO1xuICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJ1JlZ0V4cFxcXFxifFxcXFwvW15cXFxcL10nKTtcbiAgICBpZihyZWdleC50ZXN0KHZhbCkpIHtcbiAgICAgICAgcmV0dXJuICdSZWdFeHAnO1xuICAgIH1cbiAgICBpZih2YWwuc2xpY2UoMCw0KSA9PSAnbmV3ICcpIHtcbiAgICAgICAgcmVnZXggPSBuZXcgUmVnRXhwKFxuICAgICAgICAgICAgJ25ldyAoJyArIHRoaXMuc2V0dGluZ3MuZm5JZGVudGlmaWVyICsgJyknXG4gICAgICAgICAgICApO1xuICAgICAgICB2YXIgbWF0Y2hlcyA9IHJlZ2V4LmV4ZWModmFsKTtcbiAgICAgICAgcmV0dXJuIChtYXRjaGVzWzBdICYmIG1hdGNoZXNbMV0pIHx8IG51bGw7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUeXBlc2NyaXB0UGFyc2VyO1xuIl19